#pragma once
#include "window.hpp"
#include <GL/glew.h>
#include <GLFW/glfw3.h>
#include <optional>
#include <string>
#include <variant>

namespace opengl {
////////////////////////////////////////////////////////////////////////////////
// opengl::render
////////////////////////////////////////////////////////////////////////////////
struct render
{
  //////////////////////////////////////////////////////////////////////////////
  // Commands
  //////////////////////////////////////////////////////////////////////////////

  struct Start
  {};

  struct Finish
  {};

  //////////////////////////////////////////////////////////////////////////////
  // Events
  //////////////////////////////////////////////////////////////////////////////

  struct Started
  {};

  struct Finished
  {};

  struct Error
  {
    std::string description;
  };

  //////////////////////////////////////////////////////////////////////////////
  // State
  //////////////////////////////////////////////////////////////////////////////

  struct state_type
  {
    GLFWwindow* window = nullptr;
  };

  //////////////////////////////////////////////////////////////////////////////
  // Execute
  //////////////////////////////////////////////////////////////////////////////

  static std::variant<Error, Started> execute(const state_type& state, const Start& cmd);

  static Finished execute(const state_type& state, const Finish& cmd);

  //////////////////////////////////////////////////////////////////////////////
  // Apply
  //////////////////////////////////////////////////////////////////////////////

  static state_type apply(const state_type& state, const window::Created& evt);

  static state_type apply(const state_type& state, const window::Terminated& evt);

  //////////////////////////////////////////////////////////////////////////////
  // Process
  //////////////////////////////////////////////////////////////////////////////

  static Start process(const state_type& state, const window::Created& evt);

  static Finish process(const state_type& state, const Started& evt);

  static std::optional<Start> process(const state_type& state, const Finished& evt);
};
}
